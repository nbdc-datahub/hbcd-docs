# Quality Control Procedures   

## QC Dashboard

After EEG acquisition, quality control checks are performed using [EEG2BIDS Wizard](https://github.com/aces/eeg2bids), a custom MATLAB application installed at all HBCD sites. These checks are immediately provided to the user to ensure the data's integrity and usability. The process includes:

- Verifying event markers in the EEG data to confirm all required events are accurately recorded.
- Ensuring the setup for stimulus presentation and EEG data acquisition adheres to the study protocol.
- Inspecting electrode impedances to ensure they are within acceptable limits.
- Detecting multiple task runs and incomplete recordings.
- Confirming the use of correct E-Prime task versions.

Both study sites and the EEG Core team use an EEG Quality Control dashboard developed by LORIS to access and monitor incoming EEG data and QC metrics, such as retained epochs and line noise levels. Outputs from the HBCD-Maryland Analysis of Developmental EEG ([HBCD-MADE](https://hbcd-made.readthedocs.io/en/latest/)) pipeline, which handles preprocessing and data cleaning, are also integrated into the dashboard. These outputs include key metrics like outlier statistics for specific task epochs ([Debnath et al., 2020](https://doi.org/10.1111/psyp.13580)). Regular site-specific check-ins and troubleshooting are conducted to ensure consistent protocol adherence and data quality across sites. For a detailed description of QC procedures in the HBCD Study EEG protocol, refer to [Fox et al., 2024](https://doi.org/10.1016/j.dcn.2024.101447).

During quality control, a frequently observed issue across all tasks was the irregular application of EEG sensors. Additionally, partial task completion due to infant fussing and missing stimulus flags were commonly noted for the faces and auditory mismatch negativity tasks.

## Stimtracker Artifact Detection

<div class="table-banner">
  <span class="emoji"><i class="fa-regular fa-lightbulb"></i></span>
  <span class="text">Presence of the StimTracker artifact is listed in the tabulated QC file for each task (<code>eeg_qc_task-&lt;TASK&gt;</code>).</span>
</div>
<p></p>

<div style="display: flex; align-items: center; gap: 20px;">
  <!-- Text on the left -->
  <div style="flex: 1;">
    <p>
    The <strong>StimTracker</strong> device is used during EEG acquisition for the V03, V04, and V06 visits. It provides precise timing of auditory or visual stimulus onset and marks the start and end of each task. The EEG Core identified an electrical artifact at stimulus onset and offset, caused by an intermittent electrical spike generated by the device. This artifact appears in only a subset of files collected with current HBCD systems.
    </p>
    <p>
    To screen for the artifact, the EEG Core developed a custom MATLAB script that averages all epochs per task and flags voltage fluctuations (>1 µV) in two time windows: –10 to 10 ms and 250 to 270 ms (onset and offset of the voltage spike).
    <p>
  </div>
  <!-- Image on the right -->
  <div style="flex: 1; text-align: center;">
    <img src="../images/Fig1.png" style="max-width:100%; height:auto; display:block; margin:0 auto;">
    <p style="font-size: 0.8em; margin-top: 5px; line-height: 1.1; max-width:100%; margin-left:auto; margin-right:auto; text-align:justify;">
      <b>Figure 1.</b> Example of the electrical artifact detected in the MMN auditory oddball task in E55. 
      The artifact is characterized by a negative deflection at stimulus onset and a positive deflection at offset.
    </p>
  </div>
</div>
   
Files flagged with the artifact in the raw EEG data (40-50%) were visually inspected after preprocessing with the MADE pipeline by examining all channels averaged across all trials.  If the artifact remained visible in the preprocessed data, the file was marked as containing the StimTracker artifact. If the artifact was not visible after MADE preprocessing, the file was labeled as artifact-free, reflecting sufficient artifact removal. 

Approximately 10% of the V03 files had the StimTracker artifact after preprocessing with MADE. 

To examine the impacts of the artifact on the derivates provided by the EEG Core, event-related potentials (ERPs) were generated for the regions and time windows of interest for each task. Because there were many more artifact-free files compared to files with the StimTracker artifact, we randomly selected 100 artifact-free files and 100 files with the identified artifact for each task. Click <a href="../artifacts" target="_blank">here</a> to see the figures displaying the waveforms for the different tasks and ROIs, for both artifact-free and artifact-present files. 

Based on this current evaluation, we believe that the StimTracker artifact does not functionally effect the mean amplitudes for the ERPs released as part of the EEG derivatives. To fully probe the breadth of any evident differences, we conducted statistical analyses for mean amplitudes from the ERP components from each task, comparing artifact-free and artifact-present files (click <a href="../artifacts" target="_blank">here</a> for details). After correction (FDR), only two significant differences occurred, evident in the T7T8 cluster for the standard and deviant conditions of the MMN. The difference waves (Predeviant-Deviant) between files with and without the StimTracker artifact revealed no significant differences for the FCz cluster or the T7T8 cluster.  No significant differences were found in the VEP or FACEs tasks. 

Overall, we believe the stimtracker artifact makes a minimal impact on the data. However, we encourage users to examine potential effects in their own analyses. This can be done using the eeg_qc_-<task> variable present on the task-level EEG_QC csv file generated by the tabulated query section of LASSO. This will provide a binary variable indicating whether the StimTracker artifact was present (yes/no) in the processed data, allowing for individual analyses. We did not conduct similar comparisons for V04 files, given the low number of files containing the artifact.

Click <a href="../artifacts" target="_blank">here</a> for more information about the StimTracker artifact.

### Effects of Artifact on ERP Derivatives by Task
ERPs were computed for each task and ROI. Because of the uneven number of files with and without the StimTracker artifact 100 files were randomly selected from the group with the artifact and 100 files were selected from the group without the artifact. Waveforms for each ERP are displayed below. Differences were evaluated for each task and ROI and are presented in the tables below.

<div id="vep" class="table-banner" onclick="toggleCollapse(this)">
  <span class="emoji"><i class="fa-solid fa-file-waveform"></i></span>
  <span class="text-with-link">
  <span class="text">VEP</span>
  <a class="anchor-link" href="#vep" title="Copy link">
  <i class="fa-solid fa-link"></i>
  </a>
  </span>
  <span class="arrow">▸</span>
</div>
<div class="table-collapsible-content">
<img src="../images/vep-erp-oz.jpeg" width="50%" height="auto" class="center">
<p></p>
<table class="compact-table-no-vertical-lines" style="width: 100%; border-collapse: collapse; table-layout: fixed; font-size: 13px;">
<thead>
<tr>
    <th style="word-wrap: break-word; white-space: normal;">Measure</th>
    <th style="word-wrap: break-word; white-space: normal;">N1 (40-79 ms) Mean Difference</th>
    <th style="word-wrap: break-word; white-space: normal;">N1 (40-79 ms) Significance</th>
    <th style="word-wrap: break-word; white-space: normal;">P1 (80-140 ms) Mean Difference</th>
    <th style="word-wrap: break-word; white-space: normal;">P1 (80-140 ms) Significance</th>
    <th style="word-wrap: break-word; white-space: normal;">N2 (141 - 300 ms) Mean Difference</th>
    <th style="word-wrap: break-word; white-space: normal;">N2 (141 - 300 ms) Significance</th>
</tr>
</thead>
<tbody>
<tr>
    <td style="word-wrap: break-word; white-space: normal;">Mean Amplitude</td>
    <td style="word-wrap: break-word; white-space: normal;">&Delta; = 0.07 &micro;V</td>
    <td style="word-wrap: break-word; white-space: normal;">p = 0.91</td>
    <td style="word-wrap: break-word; white-space: normal;">&Delta; = 0.18 &micro;V</td>
    <td style="word-wrap: break-word; white-space: normal;">p = 0.77</td>
    <td style="word-wrap: break-word; white-space: normal;">&Delta; = -0.008 &micro;V</td>
    <td style="word-wrap: break-word; white-space: normal;">p= 0.99</td>
</tr>
<tr>
    <td style="word-wrap: break-word; white-space: normal;">Peak Amplitude</td>
    <td style="word-wrap: break-word; white-space: normal;">&Delta; = -0.43 &micro;V</td>
    <td style="word-wrap: break-word; white-space: normal;">p= 0.55</td>
    <td style="word-wrap: break-word; white-space: normal;">&Delta; = 0.67 &micro;V</td>
    <td style="word-wrap: break-word; white-space: normal;">p= 0.37</td>
    <td style="word-wrap: break-word; white-space: normal;">&Delta; = -0.56 &micro;V</td>
    <td style="word-wrap: break-word; white-space: normal;">p = 0.49</td>
</tr>
<tr>
    <td style="word-wrap: break-word; white-space: normal;">Peak Latency</td>
    <td style="word-wrap: break-word; white-space: normal;">&Delta; = -0.3 ms</td>
    <td style="word-wrap: break-word; white-space: normal;">p = 0.85</td>
    <td style="word-wrap: break-word; white-space: normal;">&Delta; = 0.1 ms</td>
    <td style="word-wrap: break-word; white-space: normal;">p = 0.98</td>
    <td style="word-wrap: break-word; white-space: normal;">&Delta; = -1.3 ms</td>
    <td style="word-wrap: break-word; white-space: normal;">p = 0.86</td>
</tr>
<tr>
<td colspan="7" style="font-size: 1.0em; word-wrap: break-word; white-space: normal; border-bottom: none;"><b>Table 1.</b> Differences in ERPs between the artifact containing (n=100) and artifact-free (n=100) files.  Mean differences for mean amplitude, peak amplitude, and peak latency for the Oz cluster are presented for our time windows of interest.</td>
</tr>
</tbody>
</table>
</div>

<div id="mmn" class="table-banner" onclick="toggleCollapse(this)">
  <span class="emoji"><i class="fa-solid fa-file-waveform"></i></span>
  <span class="text-with-link">
  <span class="text">MMN</span>
  <a class="anchor-link" href="#mmn" title="Copy link">
  <i class="fa-solid fa-link"></i>
  </a>
  </span>
  <span class="arrow">▸</span>
</div>
<div class="table-collapsible-content">
<img src="../images/mmn-artifact.jpeg" width="100%" height="auto" class="center">
<p></p>
<table class="compact-table-no-vertical-lines" style="width: 100%; border-collapse: collapse; table-layout: fixed; font-size: 14px;">
<thead>
<tr><th>Condition</th><th>ROI</th><th>Mean Amp Artifact (uV)</th><th>Mean Amp No Artifact (uV)</th><th>Delta (uV)</th><th>p Value</th><th>p Value Adj. (FDR)</th></tr>
</thead>
<tbody>
<tr><td>Standard</td><td>FCz</td><td>1.25</td><td>1.264</td><td>-0.014</td><td>0.946</td><td>0.946</td></tr>
<tr><td>Standard</td><td>T7T8</td><td>1.482</td><td>0.921</td><td>0.562</td><td>0.013</td><td>0.039</td></tr>
<tr><td>Predeviant</td><td>FCz</td><td>1.349</td><td>1.437</td><td>-0.089</td><td>0.77</td><td>0.946</td></tr>
<tr><td>Predeviant</td><td>T7T8</td><td>1.279</td><td>0.641</td><td>0.637</td><td>0.055</td><td>0.11</td></tr>
<tr><td>Deviant</td><td>FCz</td><td>1.478</td><td>1.444</td><td>0.034</td><td>0.927</td><td>0.946</td></tr>
<tr><td>Deviant</td><td>T7T8</td><td>3.118</td><td>1.987</td><td>1.132</td><td>0.004</td><td>0.024</td></tr>
<tr><td colspan="7" style="font-size: 13px; word-wrap: break-word; white-space: normal;"><b>Table 2.</b> Differences between the artifact containing (n=100) and artifact-free (n = 100) files for the mean amplitude for each condition, ROI, and time window.<br>
<i>Note:</i> Differences between means are presented for each artifact designation, as well as the difference between them (delta). P-values were calculated for the differences between means, and then FDR corrected.  Original and corrected p-values are presented.</td></tr>
</tbody>
</table>
<table class="compact-table-no-vertical-lines" style="width: 100%; border-collapse: collapse; table-layout: fixed; font-size: 14px;">
<thead>
<tr><th>Contrast</th><th>ROI</th><th>Mean Amp Artifact (uV)</th><th>Mean Amp No Artifact (uV)</th><th>Delta (uV)</th><th>p Value</th></tr>
</thead>
<tbody>
<tr><td>Deviant-Predeviant</td><td>FCz</td><td>0.24</td><td>-0.10</td><td>0.34</td><td>0.45</td></tr>
<tr><td>Deviant-Predeviant</td><td>T7T8</td><td>1.70</td><td>1.03</td><td>0.67</td><td>0.10</td></tr>
<tr><td colspan="6" style="font-size: 13px; word-wrap: break-word; white-space: normal; border-bottom: none;"><b>Table 3.</b> Differences in mean amplitude for the difference wave of files containing the artifact (n = 100) and artifact-free files (n = 100). 
Contrast</td></tr>
</tbody>
</table>
</div>

<div id="mmn" class="table-banner" onclick="toggleCollapse(this)">
  <span class="emoji"><i class="fa-solid fa-file-waveform"></i></span>
  <span class="text-with-link">
  <span class="text">MMN</span>
  <a class="anchor-link" href="#mmn" title="Copy link">
  <i class="fa-solid fa-link"></i>
  </a>
  </span>
  <span class="arrow">▸</span>
</div>
<div class="table-collapsible-content">


## EEG Net Placement ("Capping Quality") Ratings

<div class="table-banner">
  <span class="emoji"><i class="fa-regular fa-lightbulb"></i></span>
  <span class="text">Capping ratings are included in the tabulated QC files for each task (<code>eeg_qc_task-&lt;TASK&gt;</code>).</span>
</div>
<p></p>

EEG capping quality ratings are used to determine inclusion in data processing. Photos used to assess EEG capping quality are taken for each acquisition from the front, back, top, left, and right angles of the participant's head and uploaded via the BIDS Wizard application to a secure computing environment. They are then reviewed by the EEG Core at the University of Maryland to rate the quality of EEG net placement, or "capping quality," for each acquisition.

<table class="table-no-vertical-lines" style="width: 100%; border-collapse: collapse; table-layout: fixed; font-size: 18px;">
  <tbody>
    <tr>
      <td style="width: 30%;"><strong>Markers of Proper Net Placement</strong></td>
      <td>
        <ul style="margin: 0; padding-left: 1.2em;">
          <li>Reference electrode <strong>(REF)</strong> at the vertex</li>
          <li>Nasion electrode <strong>(#17)</strong> between eyebrows</li>
          <li>Ear electrodes <strong>(#44, #114)</strong> at preauricular points</li>
        </ul>
      </td>
    </tr>
    <tr>
      <td><strong>Net Placement Rubric</strong></td>
      <td>
        <ul style="margin: 0; padding-left: 1.2em;">
          <li><strong>Excellent</strong> – all markers <strong>0–0.5 cm</strong> from correct placement</li>
          <li><strong>Average</strong> – any marker <strong>0.5–2 cm</strong> off</li>
          <li><strong>Poor</strong> – any marker <strong>2–3 cm</strong> off</li>
          <li><strong>Very Poor</strong> – any marker <strong>>3 cm</strong> off</li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

Please refer to the [HBCD EEG Acquisition Protocol](https://zenodo.org/records/14795030) for additional information about capping requirements.

<br>

